<php>$mobile_title = $detail['title'];</php>
<include file='public:header'/>   
 <script src="/static/default/wap/js/global.js"></script> 
 <script src="/static/default/wap/js/3deye.min.js"></script>
<script src="/static/default/wap/js/jquery.js"></script>
<script src="/static/default/wap/js/clipboard.js"></script>

<script src="/static/default/wap/other/cookie.js"></script>
<script src="/static/default/wap/js/elecart.js"></script>
<script src="/static/default/wap/js/dialog.js"></script>
<script src="/static/default/wap/js/jquery.fly.min.js"></script>


<link rel="stylesheet" href="/static/default/wap/css/stores.css">

<header class="top-fixed bg-yellow bg-inverse detail">
	<div class="top-back">
		<a class="top-addr" href="javascript:history.go(-1)"><i class="iconfont icon-angle-left"></i></a>
	</div>
	<div class="top-title search center">
        商品详情
<!--&lt;!&ndash;		<span class="on">商品</span>&ndash;&gt;-->
<!--        <span>详情</span>-->
<!--        <span><a href="<{:U('mall/dianping',array('goods_id'=>$detail['goods_id']))}>">评论</a></span>-->
	</div>
<!--    <div class="top-signed">-->
<!--		<a id="search-btn" href="<{:U('mall/cart')}>"><i class="iconfont icon-yunzhi2gouwuche"></i><span class="badge bg-red"><{$cartnum}></span></a>-->
<!--	</div>-->
</header>


   
<div class="xq_details" style="margin-top: 50px">
        <div class="tuan-detail">
            <div class="line banner">	
                <div id="focus" class="focus">
                    <div class="bd">
                            <a href="javascript:void(0);"><img style="height: 200px;width: 100%;" src="<{:config_img($detail['photo'])}>" /></a>
                    </div>
                </div>
           </div>
        </div>
		<div class="item-detail" >
			<div class="detail-row bb" style="width: 94%;margin-left: 3%;padding: 10px 0 10px 0">
				<div class="item-price">
                    <h5>
                        <if condition="$detail['is_new'] eq 1">
                            <span style="background-color: #f4c904;padding: 2px;border-radius: 5px;color: #fff">新品</span>
                        <elseif condition="$detail['is_hot'] eq 1"/>
                            <span style="background-color: red;padding: 2px;border-radius: 5px;color: #fff">热门</span>
                        <elseif condition="$detail['is_tuijian'] eq 1"/>
                            <span style="background-color: green;padding: 2px;border-radius: 5px;color: #fff">推荐</span>
                        </if>
                        <p style="color: black;"><b><{$detail['product_name']}>：</b><span style="color: red"><{:tu_msubstr($detail['desc'],0,80)}></span></span></h5>
                    <if condition="$detail['is_yuyue'] eq 1">
                        <span style="background-color: red;color: #fff;padding: 0px 5px 0px 5px;border-radius: 5px;">可预定</span>
                        <span class="text-green">送货时间：<{$detail['yuyue_time']}></span><br/>
                    </if>
                    <span class="text-gray text-small">月售：<{$detail['month_num']}>份 </span>
					<p class="price"  id="goods_price"> <span style="color: red;font-size: 25px;">&yen;<{$detail['price']}></span>
                        <del style="color: #9c9c9c">&yen; <{$detail['cost_price']}></del>
                        <span class="pre-price-tips">
                        <php>$zhe = round($detail['cost_price']/$detail['price']*1,2);</php>
                        <if condition="$zhe neq 10">
                        	<span class="dt-icon" style="color:red;"><?php $discount = round(10 / ($detail['cost_price']/$detail['price']), 1); echo $discount;?>折</span>
                        </if>
                        </span>
                        <span style="color: red">返积分:<{:round($detail['price']*($config['store']['storejifen']/100)/100,2)}></span>
                        <span style="float: right;margin-right: 20px;">
                            <input autocomplete="off" type="number" class="change_price" style="padding:5px;border:1px #999 solid;width: 80px;margin-left: -12px;" placeholder="请输入斤数" price="<{$detail['price']}>" cost="<{$detail['cost_price']}>"  did="<{$detail.product_id}>" class="ordernum-<{$detail.product_id}>"  value="<{:getMarketCartNum($detail['product_id'],$detail['shop_id'])}>" />
                            <span>斤</span>
                        </span>
                    </p>

				</div>
			</div>
		</div>
</div>
<style>

    #category {width:100%;display: inline;white-space: nowrap;overflow-x:scroll;float:left;overflow-y:hidden;line-height: 40px;background-color: #fff;margin-top: 15px;}
    #category li{display:inline-block;width:80%;height:150px;padding-left:10px;}
    .cate-descs{display: block;}
    .biaoti{height: 50px;}
    .im{width:20%;height: 100%;text-align: center;float: left;}
    .shop_logo{width: 40px;height: 40px;border-radius: 4px;border: 1px solid #e0e0e0}
    .tite{width: 40%;height: 100%;float: left}
    .tite .spa1{font-size: 15px;font-family: "Microsoft Yahei", "微软雅黑"}
    .tite .spa2{color: #9c9c9c;}
    .genduo{width: 40%;height: 100%;float: right}
    .genduo span{float: right;line-height: 50px;font-size: 16px;color: #9c9c9c;}
    .imgs-img{width: 110px;height: 80px;padding: 5px;}
    .div2{width: 100%;height: 100%;border: solid #9c9c9c50;border-radius: 5px;text-align: center}
    .div2_img{width: 45%;float: left}
    .div2_imgs{width: 45%;float: right}
    .jias{font-size: 18px;line-height: 80px;}
    .brn{margin-top: 25px;}
    .mai{padding: 0 5px 0 5px;background-color: #06c1ae;color: #fff;margin-left: 10px;border-radius: 10px;}
    .yaoqin{height: 30px;line-height: 30px;}
    .yao{font-size: 14px;margin-left: 15px;color: #f568f6;font-size: 16px;}
    .qin{float: right;margin-right: 15px;background-color: red;color: #fff;border-radius: 15px;width: 80px;text-align: center}
    .joinCart{float: right;margin-right: 15px;background-color: red;color: #fff;border-radius: 15px;width: 80px;text-align: center}

    /*点击分享弹出*/
    .fu{text-align: center;width: 100%}
    .fudong1{overflow: hidden;width: 80%;height: 120px;border: 1px solid #9c9c9c50;margin-left: 10%;margin-top: 10%;word-break: break-word}
    .fudong1 p{margin-top: 20px;}
    .fuzhi{position: relative;top:40px;background: #fff;font-size: 16px;font-weight: bold}
    .fu_btn{width: 80%;padding: 2px;background: red;margin-top: 10px;border: 0;border-radius: 10px;color: #fff;font-size: 16px;}
    .jiu5{margin-top: 20px;font-size: 16px;}
    .huode{font-size: 18px;color: red;}
    .fenxians{color: #f60}

</style>
<if condition="$detail['is_tuan'] eq 1">
    <div class="blank-10 bg"></div>
    <div class="yaoqin">
        <span class="yao">邀请好友购买抢红包</span>
        <span class="qin">立即邀请</span>
        <span class="joinCart">加入购物车</span>
    </div>
    <div class="blank-10 bg"></div>
</if>
<script>
    $('.qin').click(function () {
        layer.open({
            type: 1,
            title: '',
            skin: 'layui-layer-rim', //加上边框
            area: ['80%', '380px'], //宽高
            content: '<div class="fu">' +
                '<div class="jiu5"><span ><a class="huode">恭喜您</a><br/><span class="fenxians">赶快分享好友购买，红包马上拿哦</span></span></div>' +
                '<span class="fuzhi">口令成功复制</span> <div class="fudong1"><input type="hidden" id="product_id" value="<{$detail[product_id]}>">' +
                '<input type="hidden" id="shop_id" value="<{$detail[shop_id]}>"><p id="zhi">复制整段信息，打开☞阿涂发发☜，即可参与【哇，这里有大牌超值红包任你抢，就差你帮我买一份了>>>】' +
                '(未安装App的点这里：https://<?php echo $_SERVER['HTTP_HOST']?>/wap/store/details/product_id/<?php echo $detail['product_id'];?>.html?user_id=<?php echo $MEMBER['user_id'];?>))</p></div>' +
                '<button  class="fu_btn" id="btn_btn" data-clipboard-target="#zhi">去粘贴分享</button>' +
                '</div>'
        });

        $("#btn_btn").click(function(){
            let e = document.getElementById("zhi").innerText;
            //实例化clipboard
            var clipboard = new ClipboardJS('#btn_btn');

            clipboard.on("success", function(e){
                layer.msg("复制成功！");
            });
            clipboard.on("error", function(e){
                layer.msg("复制失败！");
            });
        });
    });

    $('.joinCart').click(function () {
        var product_id = '<?php echo $detail["product_id"] ?>';
        var shop_id = '<?php echo $detail["shop_id"] ?>';

        $.post('<{:U("market/addCart")}>', {shop_id: shop_id, product_id:product_id}, function (data) {
            if(data.status == 'success'){
                layer.msg(data.msg, {icon: 1});
            }else{
                layer.msg(data.msg, {icon: 2});
            }				
        }, 'json')
    });
</script>

<style>
    .jies{width: 94%;height: auto;margin-left:3%;border: 1px solid #C9C5C5;padding: 5px;border-radius: 10px;color: red}
    .huodong{width: 94%;height: auto;margin-left:3%;margin-top: 10px;border: 1px solid #C9C5C5;padding: 5px;border-radius: 10px;}
    .huodongimg{width: 20px;height: 20px;float: left}

    .hide{ display:none}
    .tudou-cart-num-mask{ position:fixed;  display:none; z-index:80; top:0; left:0; width:100%; height:100%; background: rgba(0, 0, 0, 0.6); filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#BF000000,endColorstr=#BF000000);}
    .tudou-cart-num-mask .cont{ position:absolute; bottom:48px; left:0; width:100%; background:#fff;}
    .tudou-cart-num-mask .title1{ overflow:hidden; font-size:14px; color:#333; line-height:2.34rem; padding:0 0.6rem; background:#f7f7f7;}
    .tudou-cart-num-mask .title1 .closs{ font-size:16px;}
    .tudou-cart-num-mask .nr{padding:0.6rem;}
    .tudou-cart-num-int{margin:0.2rem 0;}
    .tudou-cart-num-int .table th {}
    .tudou-cart-num-int ul li{display:block; float:left;}
    .tudou-cart-num-int span{cursor: pointer; display:inline-block; height:1.6rem; width:1.6rem; border: 0.1rem solid #dedede; background: #f0f0f0 none; font-size: 14px; line-height:1.4rem; text-align: center; outline: none;}
    .tudou-cart-num-int input[type="text"] { width:2.4rem; border: none 0; border-top: 0.1rem solid #dedede; border-bottom: 0.1rem solid #dedede; background: #fff none; font-size: 14px; line-height:1.5rem; text-align: center;  vertical-align: middle; padding: 0; border-radius: 0;}
    .tudou-cart-num-mask .btn_box{ border-top: 0.1rem solid #dedede; padding:0.6rem 0 0; text-align:center;}
    .tudou-cart-num-mask .btn{ display:inline-block; width: 80%; height: 2.1rem; line-height: 2.1rem; background: #2FBDAA; border-radius: 0.34rem; text-align: center; color: #FFF; font-size: 14px;}
    .labdiv{margin-top: 5px}
</style>

<div style="height: auto;background-color: #fff">
    <div class="huodong">
        <if condition="$eleshop['is_full'] eq 1">
            <div>
            <label><img class="huodongimg" src="/static/wai/jian.png"></label>
            <label>
                <if condition="!empty($eleshop['order_price_full_1'])">
                    满&yen;<{$eleshop['order_price_full_1']}>减 &yen;<{$eleshop['order_price_reduce_1']}>
                </if>
                <if condition="!empty($eleshop['order_price_full_2'])">
                    ，满&yen;<{$eleshop['order_price_full_2']}>减 &yen;<{$eleshop['order_price_reduce_2']}>
                </if></label>
            </div>
        </if>

        <if condition="!empty($eleshop['logistics_full'])">
            <div class="labdiv">
        <label><img class="huodongimg" src="/static/wai/mian.png"></label>
        <label>满&yen<{$eleshop['logistics_full']}>，免配送费</label>
            </div>
        </if>
        <if condition="$eleshop['is_new'] eq 1">
        <div class="labdiv">
            <label><img class="huodongimg" src="/static/wai/shou.png"></label>
            <label>  新用户首次下单满&yen;<{$eleshop['full_money']}>减 &yen;<{$eleshop['new_money']}></label>
         </div>
        </if>
        <if condition="$eleshop['is_yuyue'] eq 1">
            <div class="labdiv">
                <label><img class="huodongimg" src="/static/wai/yuyue.png"></label>
                <label> 可预约购买</label>
            </div>
        </if>
    </div>
</div>

<style>
    /*点击中间弹出*/
    .box-s{width: 100%;height: 40px;line-height: 40px;font-size: 16px;margin-left: 10px;color: #999999}
    .box-s .box_ben{float: right;width: 100px;line-height: 40px;}
    #box{padding: 2px;border: 1px solid #99999950;width: 100%;overflow:hidden;max-height: 108px;}
    .one{width: 100%;height: 50px;overflow:hidden;}
    .two{width: 80px;height: 100%;float: left}
    .two span{line-height: 50px;margin-left: 5px;font-size: 16px;color: black;}
    .xia{text-decoration: none;}
    .tu{width: 20px;height: 20px;border-radius: 100%;float: left;}
    .tus{width: 40px;height: 40px;border-radius: 100%;float: left}
    .three{width: 120px;float: left;}
    .three2{width: 120px;float: left;}
    .four{float: right;margin-right:10px;height: 36px;margin-top: 6px;line-height: 36px;text-align: center;background-color: red;color: #fff;font-size: 16px;border-radius: 5px;}
    .hong{color: red}
    .four2{float: right;margin-right: 25px;height: 36px;margin-top: 6px;line-height: 36px;text-align: center;background-color: red;color: #fff;font-size: 16px;border-radius: 5px;}
    .pics_img{width: 80px;height: 80px;}
    .three{width: 120px;float: left;margin-left: 5%;margin-top: 1%}
    .fours{padding: 2px;float: right;margin-right: 10px;background-color: red;color: #fff;border-radius: 5px}
</style>
<if condition="!empty($pintuan)">
    <div class="blank-10 bg"></div>
    <div class="box-s" >
        <{$page}>人在分享，可直接参与
        <div class="box_ben" id="btn1">
            查看更多<i class="iconfont icon-angle-right"></i>
        </div>
    </div>
    <div id="box">
        <ul>
            <foreach name="tuan" item="item">
            <li class="xia">
                <div class="one">
                    <img class="tus" src="<{:config_img($shop[$item['shop_id']][logo])}>">
                    <div class="two">
                        <input type="hidden" class="product_id" value="<{$item['product_id']}>" >
                        <input type="hidden" class="shop_id" value="<{$item['shop_id']}>">
                        <span><{:tu_msubstr($shop[$item['shop_id']]['shop_name'],0,5)}></span>
                    </div>
                    <div class="three">
                        还差<span style="color: red">1<!-- -->人</span>拼成
                    </div>
                    <input type="hidden" class="ends" value="<{$item.end_time|date='Y-m-d H:i:s',###}>">
                    <div class="three">
                        <span ></span>
                    </div>
                    <div class="fours fenx" onclick="market2(this)">
                       分享抢红包
                    </div>
                </div>
            </li>
            <hr style="margin: 2px;"/>
            </foreach>
        </ul>
    </div>
</if>

<if condition="!empty($detail['details'])">
    <div class="blank-10 bg"></div>
    <div style="width: 94%;margin-left: 4%">
        <h3>商品详情</h3>
        <{$detail['details']}>
    </div>
    <div class="blank-10 bg"></div>
</if>

<script>
    setTimeout(function(){
        var table = document.getElementById("box");
        var timer = null;
        table.scrollTop = 0;
        //table.innerHTML += table.innerHTML;
        function play() {
            clearInterval(timer);
            timer = setInterval(function() {
                table.scrollTop++;
                if (table.scrollTop >= table.scrollHeight / 2) {
                    table.scrollTop = 0;
                }
            }, 100);
        }
        setTimeout(play, 10);
    },0)

    $(document).ready(function (){
        $('#btn1').click(function () {
            layer.open({
                type: 1,
                title: '拼单列表',
                skin: 'btn2', //样式类名
                closeBtn: 1, //不显示关闭按钮
                anim: 2,
                area: ['350px', '500px'], //宽高
                shadeClose: true, //开启遮罩关闭
                content: '<div id="btn2"><ul> <foreach name="tuan" item="item">' +
                    '<li class="xia"><div class="one"> <input type="hidden" class="product_id" value="<{$item[\'product_id\']}>">' +
                    '<input type="hidden" class="shop_id" value="<{$item[\'shop_id\']}>">'+
                    '<img class="tus" src="<{:config_img($shop[$item[\'shop_id\']][logo])}>">' +
                    '<div class="two"><span><{:tu_msubstr($shop[$item[\'shop_id\']][\'shop_name\'],0,5)}></span></div>' +
                    ' <div class="three">还差<span style="color: red">1<!-- -->人</span>拼成</div>' +
                    '<input type="hidden" class="ends" value="<{$item.end_time|date=\'Y-m-d H:i:s\',###}>">' +
                    '<div class="three"><span ></span> </div>'+
                    '<div class="fours" onclick="market2(this)">' +
                    '分享抢红包</div></div></li> <hr style="margin: 2px;"/>' +
                    '</foreach></ul></div>'
            });

        })
    });

   function market2(l){
       var _this = $(l);
       F = function (str) {
           return _this.parent().find(str);
       };
       product_id = F('.product_id').val();
       shop_id=F('.shop_id').val();

        layer.open({
            type: 1,
            title: '',
            skin: 'layui-layer-rim', //加上边框
            area: ['80%', '380px'], //宽高
            content: '<div class="fu">' +
                '<div class="jiu5"><span ><a class="huode">恭喜您</a><br/><span class="fenxians">赶快分享好友购买，红包马上拿哦</span></span></div>' +
                '<span class="fuzhi">口令成功复制</span> <div class="fudong1"><input type="hidden" id="product_id" value="<{$detail[product_id]}>">' +
                '<input type="hidden" id="shop_id" value="<{$detail[shop_id]}>"><p id="zhi">复制整段信息，打开☞阿涂发发☜，即可参与【哇，这里有大牌超值红包任你抢，就差你帮我买一份了>>>】' +
                '(未安装App的点这里：https://<?php echo $_SERVER['HTTP_HOST']?>/wap/market/details/product_id/<span class="product_id"></span>.html?user_id=<?php echo $MEMBER['user_id'];?>))</p></div>' +
                '<button  class="fu_btn" id="btn_btn" data-clipboard-target="#zhi">去粘贴分享</button>' +
                '</div>'
        });

       $(".product_id").text(product_id);
       $("#product_id").val(product_id);
       $("#shop_id").val(shop_id);

        $("#btn_btn").click(function(){
            let e = document.getElementById("zhi").innerText;
            //实例化clipboard
            var clipboard = new ClipboardJS('#btn_btn');

            var product_id=document.getElementById('product_id').value;
            var shop_id=document.getElementById('shop_id').value;
            $.ajax({
                url: '<{:U("market/fenxian")}>',
                data:{product_id:product_id,shop_id:shop_id},
                type: 'post',
                success: function (data) {
                    if (data.status == 'success') {

                    } else {

                    }
                }
            });
            clipboard.on("success", function(e){
                layer.msg("复制成功！");

            });
            clipboard.on("error", function(e){
                layer.msg("复制失败！");
            });
        });
    }

    //时间为一位数时显示格式为："0X"
    function checkTime(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
    }

    function checkTimeS(i) {
        if (i < 10) {
            i = i;
        }
        return i;
    }

    //显示浏览器现在的时间
    function formatTime(timeVal) {
        var datePara = new Date(timeVal);//定义日期对象
        var yyyy = datePara.getFullYear();//通过日期对象的getFullYear()方法返回年
        var MM = datePara.getMonth() + 1;//通过日期对象的getMonth()方法返回月
        var dd = datePara.getDate();//通过日期对象的getDate()方法返回日
        var hh = datePara.getHours();//通过日期对象的getHours方法返回时
        var mm = datePara.getMinutes();//通过日期对象的getMinutes方法返回分
        var ss = datePara.getSeconds();//通过日期对象的getSeconds方法返回秒
        // 如果分钟或小时的值小于10，则在其值前加0，比如如果时间是下午3点20分9秒的话，则显示15：20：09
        MM = checkTime(MM);
        dd = checkTime(dd);
        hh = checkTime(hh);
        mm = checkTime(mm);
        ss = checkTime(ss);

        //用于保存星期（getDay()方法得到星期编号）
        var day;
        if (datePara.getDay() == 0) day = "星期日 "
        if (datePara.getDay() == 1) day = "星期一 "
        if (datePara.getDay() == 2) day = "星期二 "
        if (datePara.getDay() == 3) day = "星期三 "
        if (datePara.getDay() == 4) day = "星期四 "
        if (datePara.getDay() == 5) day = "星期五 "
        if (datePara.getDay() == 6) day = "星期六 "

        //document.getElementById('start').value = yyyy + "-" + MM + "-" + dd + " " + hh + ":" + mm + ":" + ss + " " + day;
        //setTimeout('formatTime()', 1000);//每一秒中重新加载formatTime()方法
        return yyyy + ":" + MM + ":" + dd + " " + hh + ":" + mm + ":" + ss; //+ " " + day;
    }

    //服务器现在的时间（这里只是测试，就用浏览器时间代替）
    var startTime = '';
    //活动截止时间endTime（以服务器时间为标准，即给定的时间）
    var end = '';
    var endTime = '';
    //活动截止时间（以浏览器时间为标准）
    var browserEndTime = '';
    //距离活动结束还剩余的时间（以浏览器为标准）

    function for_setTimer(){
        //console.log(3333);
        var times=$.each($('.ends'),function (index,obj) {
            setTimer($(obj));
        });
    }
    var plus ="";
    //倒计时
    function setTimer(obj) {
        end=obj.val();
        endTime = new Date(end);
        if (endTime>0) {
            //服务器现在的时间（这里只是测试，就用浏览器时间代替）
            startTime = new Date();
            //活动截止时间endTime（预先给定的值）

            //活动截止时间与当前时间的时间差
            plus = endTime - startTime;
        } else {

            //距离活动结束还剩余的时间，第二次以后就不需要再计算，直接自减即可
            plus -= 1000;
            //更新当前时间(getTime()获取时间转化成毫秒后的数值)
            startTime = new Date(startTime.getTime() + 1000);
        }

        var day = parseInt(plus / 1000 / 60 / 60 / 24);
        var hour = parseInt(plus / 1000 / 60 / 60) - day * 24;
        var minute = parseInt(plus / 1000 / 60) - parseInt(plus / 1000 / 60 / 60) * 60;
        var second = parseInt(plus / 1000) - parseInt(plus / 1000 / 60) * 60;
        var millisecond = parseInt(plus %1000).toString();

        //local-group-timer
        // 如果分钟或小时的值小于10，则在其值前加0，比如如果时间是下午3点20分9秒的话，则显示15：20：09
        day = checkTime(day);
        hour = checkTime(hour);
        minute = checkTime(minute);
        second = checkTime(second);
        obj.next().html("剩"+hour + ":"+ minute +":  "+ second +":"+millisecond.charAt(0));
        if (plus <= 1) {
            clearInterval(id);
        }
    }
    //每秒循环一次，刷新活动截止时间与当前时间的时间差
    var id = setInterval(for_setTimer, 100);
</script>


<div class="tudou-cart-num-mask">
    <div class="cont">
        <div class="title1">菜市场购物车<a href="javascript:void(0);" class="closs float-right">×</a></div>
        <div class="nr">
            <div class="tudou-cart-num-int">
                <ul>




                </ul>
            </div>
        </div>
    </div>
</div>
<?php $shops=D('Market')->where(['shop_id'=>$detail['shop_id']])->find();?>
<script>
    function dianji() {
        layer.open({
            type: 1,
            title: '请选择配送方式',
            skin: 'layui-layer-rim', //加上边框
            area: ['320px', '300px'], //宽高
            content: '<div id="menuDetails" class="menu_detail">\n' +
                '    <div class="nopic">\n' +
                '        <div style="margin-top: 10px;height: 30px;line-height: 30px;text-align: center;"><p>请选择配送费</p></div>\n' +
                '        <div style="margin-top: 15px;width: 100%">\n' +
                '            <span href="javascript:void(0);">专送配送费：￥<{$logistics}> </span><a href="javascript:void(0)" style="color:#FFFFFF;background-color: #2FBDAA;float: right;margin-right: 10%;border-radius: 5px;padding: 3px;" target="x-frame" class="queryorders" data-type="1">确认下单</a>\n' +
                '        </div>\n' +
                '        <div style="margin-top: 40px;">\n' +
                '            <span href="javascript:void(0);">直达配送费：￥<{$zdlogistics}> </span><a href="javascript:void(0)" style="color:#FFFFFF;background-color: #2FBDAA;float: right;margin-right: 10%;border-radius: 5px;padding: 3px;" target="x-frame" class="queryorders" data-type="2">确认下单</a>\n' +
                '        </div>\n' +
                '<if condition="$shops['is_logistics'] eq 1"><div style="margin-top: 40px;">\n' +
                '            <span href="javascript:void(0);">外地物流配送：￥<{$logisticsfee}></span><a href="javascript:void(0)" style="color:#FFFFFF;background-color: #2FBDAA;float: right;margin-right: 10%;border-radius: 5px;padding: 3px;" class="queryorders"  target="x-frame" data-type="3">确认下单</a>\n' +
                '        </div></if>'+
                ' <if condition="$shops['is_carry'] eq 1">' +
                '        <div style="margin-top: 40px;">' +
                '            <span href="javascript:void(0);">到店自取</span><a href="avascript:void(0)" style="color:#FFFFFF;background-color: #2FBDAA;float: right;margin-right: 10%;border-radius: 5px;padding: 3px;" class="queryorders" data-type="4" target="x-frame">确认下单</a>' +
                '        </div></if>'+
                '    </div>\n' +
                '\n' +
                '</div>'
        });
        $(".queryorders").click( function (){
            var type = $(this).attr("data-type");
            var pinuser = '<?php echo $_GET["user_id"];?>';
            var url = "<{:U('market/orders',array('t'=>$nowtime))}>" +"?type="+type+"&user="+pinuser;
            window.location.href = url;

        });
    }


    //添加弹出的商品到购物车
    function addcart(o){
        var data = {},did = $(o).attr('did'), shop_id = "<{$_GET['shop_id']}>";
        data['product_id'] = $(o).attr('did');
        data['price']      = $(o).attr('val');

        var v = $(".ordernum-" + did).val();
        if(v < 99){
            v++;
            $(".ordernum-"+did).val(v);
        }
        window.store.addcart(shop_id,data);
        $("#num").text(window.store.count());
    }

    //加入购物车特效
    $(function() {
        var offset = $("#num").offset();
        $(".jq_addcart").click(function(event) {
            var addcar = $(this);
            var img = addcar.parent().find('img').attr('src');
            var flyer = $('<img class="u-flyer" src="' + img + '">');
            flyer.fly({
                start: {
                    left: event.pageX,
                    top: event.pageY
                },
                end: {
                    left: offset.left + 10,
                    top: offset.top + 10,
                    width: 0,
                    height: 0
                }
            });
        });
    })
</script>


<!--店铺滚动介绍开始 class="top-wrap"-->
<div class="blank-10 bg"></div>
<div id="top-wrap"  style="z-index: 999;width: 100%;">

    <div id="show_quan" style="width: 100%;height: 40px;background-color: #fff;color: #06c1ae;border-bottom: 1px solid #999999">
        <span class="on" style="margin-left: 20px;font-size: 20px;" id="dczn">选购</span>
        <span class="c" style="margin-left: 40px;font-size: 20px" id="pj" >评价</span>
        <span class="c" style="margin-left: 40px;font-size: 20px" id="sj" >商家</span>
        <span class="c" style="margin-left: 40px;font-size: 20px"  onclick="location='<{$service_url}>'">客服</span>
    </div>
    <div class="detail-info">
        <div class="detail-info-cell">
            <div class="detail-info-desc">
                <marquee  scrolldelay=100 direction=left>
            <span class="text-gray">店铺介绍：<{$eleshop.intro}>
        <span class="margin-left text-small text-yellow"><!-- 配送费：<{:round($eleshop['logistics']/100,2)}>元 -->
        <if condition="!empty($eleshop['logistics_full'])">
        	单笔订单免<{$eleshop['logistics_full']}> 元免配送费
        </if>
        <eq name="eleshop.is_full" value="1">
           <if condition="!empty($eleshop['order_price_full_1'])">
              单笔满&yen;<{$eleshop['order_price_full_1']}>元减 &yen;<{$eleshop['order_price_reduce_1']}>元
           </if>
           <if condition="!empty($eleshop['order_price_full_2'])">
              ，单笔满&yen;<{$eleshop['order_price_full_2']}>元减 &yen;<{$eleshop['order_price_reduce_2']}>元
           </if>
         </eq>
        ，(满<{$detail['since_money']}>元起送)</span>

                </marquee>
            </div>
        </div>


    </div>
</div>
<script type="text/javascript">
    $(document).ready(function(e) {
        $("#pj").click(function(e) {
            $("#diancan").hide();
            $("#shangjia").hide();
            $("#pingjia").show();
        });
        $("#dczn").click(function(e) {
            $("#diancan").show();
            $("#pingjia").hide();
            $("#shangjia").hide();
        });
        $("#sj").click(function(e) {
            $("#pingjia").hide();
            $("#diancan").hide();
            $("#shangjia").show();
        });
    });
</script>
<style>
    .goodsimg{width: 90%;height: 100px;}
    .shous{font-size: 12px;color: #999}
    .mon{font-size: 16px;color: red}
    .del{font-size: 12px;color: #999}
    .spanbtn{padding:0 5px;background-color: #06c1ae;border-radius: 52%;color: #fff;float: right;margin-right: 15px;}
    .zhe{position: absolute;top:45%;margin-left: 5%;background-color: red;color: #fff;border-radius:3px;font-size: 12px;}
    .jifen{position: absolute;top:0;margin-left: 5%;background-color: red;color: #fff;border-radius:3px;font-size: 12px;right:0;margin-right: 5%}
    .cateli{width: 50%;float: left;text-align: center;margin-bottom: 10px;position: relative;min-height: 182px;}
    h5{font-size: 12px;}

</style>
<div>
 <div id="diancan" style="background-color: #fff">
<div id="eles" class="page-center-box mt10" style="margin-top: 10px;">
<!--    <div class="frame-set-left nav">-->
<!--        <ul id="r-ggbox" class="content">-->
<!--            <li class="active" rel="all" style="border-top:0.1rem solid #dedede;padding: 8px 0 8px 0"><a href="javascript:void(0);">全部分类</a></li>-->
<!--            <foreach name="cates" item="item">-->
<!--                <li style="padding: 5px 0 5px 0;" rel="cate_<{$item.cate_id}>"><a href="javascript:void(0);" ><{:tu_msubstr($item['cate_name'],0,5,ture)}></a></li>-->
<!--            </foreach>-->
<!--        </ul>-->
<!--    </div>-->

    <div class="frame-set-rights">
        <div id="scroll">
            <div class="list-have-pic">
                    <!--菜品循环开始-->
                        <ul style="width: 100%;float: left;background-color: #fff;margin-bottom: 50px;">
                        <foreach name="cailist" item="var">
                            <li class="cateli">
                                <a href="<{:U('market/details',array('product_id'=>$var['product_id']))}>"><img class="goodsimg" url="<{:config_img($var['photo'])}>"  src="<{:config_img($var['photo'])}>"></a>
                                <div class="zhe"><?php $discount = round(10 / ($var[$var['product_id']]['cost_price']/$var[$var['product_id']]['price']), 1); echo $discount;?>折</div>
                                <div class="jifen">返积分:<{:round($var['price']*($config['store']['storejifen']/100)/100,2)}></div>
                                    <div>  <input type="hidden" suo="<{$var['desc']}>" value="<{$var['desc']}>">
                                        <span style="display: none" class="shio"><{$var['product_name']}></span>
                                        <div><h5> <{:tu_msubstr($var['product_name'],0,10,true)}></h5>
                                            </div>
                                    <div> <span class="shous">月售：<{$var.sold_num}>份</span></div>
                                        <span>
                                            <span class="mon"><{$var['price']}></span><del class="del" style="margin-right: 18px">￥<{$var['cost_price']}></del>
                                        <input autocomplete="off" type="number" class="change_price" style="border:1px #999 solid;width: 49px;margin-left: -12px;" placeholder="请输入斤数" price="<{$var['price']}>" cost="<{$var['cost_price']}>"  did="<{$var.product_id}>" class="ordernum-<{$var.product_id}>"  value="<{:getMarketCartNum($var['product_id'],$detail['shop_id'])}>" />
                                        斤
                                        </span>
                                </div>
                            </li>
                        </foreach>
                        </ul>

                    <!--菜品循环结束-->
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!--end-->
    <!-- 商家信息 -->
  <div id="shangjia" style="display: none;margin-top: 10px;position: absolute;width: 100%;">
        <div class="sjdiv1" style="background-color: #FFF;">
            <div class="sjdivtop">
                    <div>
                        <!--  <a href="javascript:void(0);" rel="mini_delivery_ejected_<{$addr.order_id}>" class="closs">× -->
                        <div class="nums" style="width: 100%;">

                            <a class="text-small button-block" style="font-size: 16px; border-bottom: 1px solid #999999;margin-bottom: 5px;padding: 10px" href="<{:U('ele/gps',array('shop_id'=>$marketshop['shop_id'],'type' => '2'))}>"> 商家地址：<{$marketshop['addr']}> <i class="iconfont icon-daohang text-blue text-default">导航到这去</i> </a>

                            <a href="tel:<{$marketshop.mobile}>" class="text-small button-block" style="padding: 10px;font-size: 16px; border-bottom: 1px solid #999999;margin-top: 5px;" >商家电话：<{:substr_replace($marketshop['tel'],'***',3,4)}> <span class="icon icon-phone"> 一键拨号</span></a>
                        </div>

                    </div>
            </div>
            <if condition="!empty($sjtu)">
            <div class="navBarBox" style="margin-top: 10px;width: 100%;height: 80px; border-bottom: 1px solid #999999;">
                <foreach name='sjtu' item='tu'>
                    <ul class="navBar">
                        <li style="float: left;">
                            <img style="width: 105px;height: 80px;margin-left: 10px;"  src="<{:config_img($tu['photo'])}>" >
                        </li>
                    </ul>
                </foreach>
            </div>
            </if>
        </div>
        <div class="blank-10"></div>
      <div style="width: 100%;background-color: #fff;height: 35px;line-height: 35px">
          <a href="<{:U('mall/qualifications',array('shop_id'=>$detail['shop_id']))}>">
              <label style="margin-left: 10px">商家资质</label>
              <label style="float: right;margin-right: 20px"><i class="iconfont icon-angle-right"></i></label></a>
      </div>
      <div class="blank-10"></div>
        <div style="background-color: #ffffff;width: 100%;height: 80px;">
            <div style="width: 100%;height: 40px;line-height: 40px;border-bottom: 1px solid #999999;">
                <img style="width: 20px;height: 20px; margin-left: 10px;margin-bottom: 11px;" src="/static/wai/pei.png">
                <span style="margin-left: 10px;">配送服务：由</span><span style="margin-left: 5px;background-color: #06c1ae;color: #ffffff;border-radius: 5px;">涂涂快送</span><span style="margin-left: 5px;">保证高品质送餐服务</span>
            </div>
        </div>
    </div>

    <!-- 评价信息开始 -->
    <script>
        var i = 43;
        var timer = setInterval(() => {
            $(".shu").html(i/10);
            if (i === 49) {
                i = 43;
            } else{
                i++;
            }
        }, 86400000)

        var j = 41;
        var timer = setInterval(() => {
            $(".bao").html(j/10);
            if (j === 44) {
                j = 41;
            } else{
                j++;
            }
        }, 86400000)

        var k = 45;
        var timer = setInterval(() => {
            $(".kou").html(k/10);
            if (k === 49) {
                k = 45;
            } else{
                k++;
            }
        }, 86400000)



        var l = 88;
        var timer = setInterval(() => {
            $(".pei").html(l);
            if (l === 100) {
                l = 88;
            } else{
                l++;
            }
        },25000)

    </script>

    <div id="pingjia" style="display: none;margin-top: 10px;position: absolute;width: 100%;height: auto;background-color: #ffffff;">
        <div style="width: 100%;height: 70px;background-color: #fff;margin-bottom: 20PX;border-bottom: 2px solid#999999;">
            <div style="width: 18%;height: 100%;margin-left: 10px;float: left;text-align: center;">
                <div style="width: 100%;height: auto;">

                    <h2 style="margin-top: 5px;color: #06c1ae"><span class="shu"><b>4.3</b></span></h2>
                </div>
                <div style="width: 100%;height: auto;">
                    <span style="color: #999999;font-size: 12px;margin-bottom: 20px;">商家评分</span>
                </div>
            </div>
            <div style="width: 50%;float: left;height:100%;margin-left: 10px;">
                <div style="width: 100%;height: 25px;margin-top: 5px;">
                    <span class="v">包装</span>
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <span style="display: block;float: right;color: #06c1ae" class="bao">4.1</span>
                </div>
                <div style="width: 100%;height: 25px;margin-top: 5px;">
                    <span class="v">口味</span>
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <img class="tu" src="/static/pingjia/xingxings.png">
                    <span style="display: block;float: right;color:#06c1ae" class="kou">4.5</span>
                </div>
            </div>
            <div style="width: 18%;height: 100%;margin-right:15px;float: right;text-align: center;">
                <div style="width: 100%;height: auto;" >

                    <h2 style="margin-top: 5px;color: #06c1ae"><span class="pei">88</span>%</h2>
                </div>
                <div style="width: 100%;height: auto;">
                    <span style="color: #999999;font-size: 12px;margin-bottom: 20px;">配送满意度</span>
                </div>
            </div>
        </div>

        <!-- 循环评价内容开始 -->
        <ul>
            <foreach name='lists' item='vars'>
                <div class="item">
                    <div class="line">
                        <div class="x2" style="margin-left: 2%"><img style="width: 90%;height: 50px;" class="pic"  src="<{:config_img($users[$vars['user_id']]['face'])}>" /></div>
                        <div style="width: 80%;float: right;">
                            <h5><{:config_user_name($users[$vars['user_id']]['nickname'])}></h5>

                            <php>$stars= intval(($vars['score'])*20);</php>
                            <p class="intro ui-starbar" ><span style="width:<{$stars}>%"></span></p>
                            <span class="intro intro1 float-right" style="margin-right: 10px;"><{$vasr.create_time|date='Y.m.d',###}></span>
                            <p class="intro"><{$vars.contents}></p>

                            <p class="info7 x12" >
                                <volist name="pics" id="pic" key="index">
                                    <eq name="pic.order_id" value="$vars['order_id']">
                                        <div class="pics" class="ac">
                                            <img class="pics_img" src="<{:config_img($pic['pic'])}>" >
                                        </div>
                                    </eq>
                                </volist>
                            </p>
                            <br/>
                            <if condition="!empty($vars['reply'])"><p class="intro x12">商家回复：<a style="color:#FF6430"><{$vars.reply}></a></p></if>
                        </div>
                    </div>
                </div>
                <div class="blank-10 bg"></div>
            </foreach>
        </ul>
        <!-- 循环评价内容结束 -->
    </div>
    <!-- 评价信息结束 -->


</div>
<style>
    #img{width: 100%;height: 150px;position: relative}
    .divzhe{position: absolute;top:43%;background-color: red;color: #fff;border-radius: 3px;}
    .lyf{float: right;display: inline-block;height: 31px;line-height: 31px;padding: 0 15px;font-size: 14px;
        color: #fff;background-color: #ff5f32;border-radius: 3px;white-space: nowrap;margin-right: 5%;}
    .nopic{margin-top: 5px;}
    .menu_detail img {max-height: 230px;}
    #price{color: red}
    .menu_detail{color: #999}
    .info{color: red}
    .qian{color: red;font-size: 16px;}
    body .winning-class {border-radius: 10px;}
    .onclk{pointer-events: none}
</style>
<script>
    // 获取导航栏到屏幕顶部的距离
    var oTop = $(".nav").offset().top;
    //获取导航栏的高度，此高度用于保证内容的平滑过渡
    var martop = $('.nav').outerHeight();

    var sTop = 50;
    // 监听页面的滚动
    $(window).scroll(function () {
        // 获取页面向上滚动的距离
        sTop = $(this).scrollTop();
        // 当导航栏到达屏幕顶端
        if (sTop >= oTop) {
            // 修改导航栏position属性，使之固定在屏幕顶端
            $(".nav").css({ "position": "fixed", "top": "100"});
            // 修改内容的margin-top值，保证平滑过渡
            $(".content").css({ "margin-top": martop });
        } else {
            // 当导航栏脱离屏幕顶端时，回复原来的属性
            $(".nav").css({ "position": "static" });
            $(".content").css({ "margin-top": "0" });
        }
    });


    //详细信息
    function liclick(l){
        var  _detailImg;
        var _this = $(l);
        F = function(str){return _this.parent().find(str);};
        title = F('.shio').text();
        imgUrl = F('img').attr('url');
        shuomin=F('input').attr('suo');
        price = F('.mon').text();
        sales = F('.sales strong').attr('class');
        saleNum = F('.sale_num').text();
        jia=F('.spanbtn').attr('did');
        zhe=F('.zhe').text();

        layer.open({
            type: 1,
            title: title,
            skin: 'winning-class', //加上边框
            area: ['320px', '340px'], //宽高
            content: '<div id="menuDetail" class="menu_detail">\n' +
                '    <img id="img" ><div class="divzhe"></div><div class="nopic"></div>\n' +
                '    <a id="detailBtn" class="lyf" onclick="addcart(this);"  did="" href="javascript:void(0);">来一份</a>\n' +
                '    <dl><dt>价格：<a class="qian">￥</a><span id="price"></span></dt<span class="price"></span></dl>\n' +
                '    <dl style=" margin-top:15px;"><dt>介绍：<span class="info"></span></dt></dl>\n' +
                '</div>'
        });
        $("#img").prop("src",imgUrl);
        $("#price").html(price);
        $(".info").html(shuomin);
        $(".lyf").attr("did",jia);
        $(".divzhe").html(zhe);
    }

</script>
<!--底部footer开始-->
<footer class="footer-cart eleFooter-cart" id="gos">
    <div class="cart" style="background-color: #00aaee;height: 100%;width: 10%;border-radius: 10px">
        <a id="cart_1" target="x-frame" class="tudou-cart-num-btn"  href="javascript:void(0);">
            <i class="iconfont icon-yunzhi2gouwuche" style="font-size: 36px;color: #fff;"></i>
            <div class="cart-num" id="num" style="bottom: 45px;left: 20px;"></div></a>
    </div>
    <div class="price">￥<span id="total_price"></span>
        <span style="margin-left: 20px;margin-top: 5px;line-height: 20px">已优惠￥<span id="hui">0.00</span></span>

    </div>
    <eq name="eleshop.is_open" value="1">
        <div id="cart_2s" onclick="dianji()" class="disable onclk"><a href="javascript:void(0);" style="color:#FFFFFF;" target="x-frame">选择下单</a></div>
        <else/>
        <div class="disable"><a href="javascript:void(0);" style="color:#FFFFFF;">已打样</a></div>
    </eq>
</footer>
<!--底部footer结束-->

<!--JS 购物车-->
<script type="text/javascript">

    $(document).ready(function () {
        var price = parseInt(window.market.totalprice("<{$detail['shop_id']}>"));
        var since_money = "<{$detail['since_money']}>";
        if(price > since_money){
            $('#cart_2').find('a').attr('href', "<{:U('market/order',array('t'=>$nowtime))}>");
            $('#cart_2').removeClass('disable');
            $('#cart_2').addClass('btn');
        }else{
            $('#cart_2').find('a').attr('href', "javascript:void(0);");
            $('#cart_2').addClass('disable');
            $('#cart_2').removeClass('btn');
        }

    })

    $(".tudou-cart-num-btn").click(function () {
        var link = "<{:U('market/loadcart')}>";
        $(".tudou-cart-num-int ul").load(link);
        $(".tudou-cart-num-mask").show();

    });
    $(".tudou-cart-num-mask").find(".closs").click(function () {
        $(".tudou-cart-num-mask").hide();
    });
    $("#ele").find(".frame-set-right").click(function () {
        $(".tudou-cart-num-mask").hide();
    });

    //添加弹出的商品到购物车
    function addcart(o){
        var data = {},did = $(o).attr('did'), shop_id = "<{$_GET['shop_id']}>";
        data['product_id'] = $(o).attr('did');
        data['price']      = $(o).attr('val');

        var v = $(".ordernum-" + did).val();
        if(v < 99){
            v++;
            $(".ordernum-"+did).val(v);
        }
        window.market.addcart(shop_id,data);
        $("#num").text(window.market.count());
    }

    //加入购物车特效
    $(function() {
        var offset = $("#num").offset();
        $(".jq_addcart").click(function(event) {
            var addcar = $(this);
            var img = addcar.parent().find('img').attr('src');
            var flyer = $('<img class="u-flyer" src="' + img + '">');
            flyer.fly({
                start: {
                    left: event.pageX,
                    top: event.pageY
                },
                end: {
                    left: offset.left + 10,
                    top: offset.top + 10,
                    width: 0,
                    height: 0
                }
            });
        });
    })


    function addcart(o) {

        var data = {}, did = $(o).attr('did'),shop_id = "<{$detail['shop_id']}>";
        data['product_id'] = $(o).attr('did');
        data['price'] = $(o).attr('val');

        var v = $(".ordernum-" + did).val();
        if(v < 99){
            v++;
            $(".ordernum-"+did).val(v);
        }
        window.market.addcart(shop_id, data);
        $("#num").text(window.market.count("<{$detail['shop_id']}>"));
        $("#total_price").html(window.market.totalprice("<{$detail['shop_id']}>"));
        var since_money = "<{$detail['since_money']}>";
        if (parseInt(window.market.totalprice("<{$detail['shop_id']}>")) < parseInt(since_money)) {
            $('#cart_2s').find('a').attr('href', "javascript:void(0);");
            $('#cart_2s').removeClass('btn');
            $('#cart_2s').addClass('disable');
        } else {
            $('#cart_2s').find('a').attr('href', "<{:U('market/order',array('t'=>$nowtime))}>");
            $('#cart_2s').removeClass('disable');
            $('#cart_2s').addClass('btn');
        }
    }
    function dec(e) {
        var product_id = $(e).attr('did'), did = $(e).attr('did'),shop_id = "<{$detail['shop_id']}>";
        window.market.dec(shop_id, product_id);
        var v = $(".ordernum-" + did).val();
        if(v > 0){
            v--;
            $(".ordernum-"+did).val(v);
        }


        $("#num").text(window.market.count("<{$detail['shop_id']}>"));
        $("#total_price").html(window.market.totalprice("<{$detail['shop_id']}>"));
        var since_money = "<{$detail['since_money']}>";
        if (parseInt(window.market.totalprice("<{$detail['shop_id']}>")) < parseInt(since_money)) {
            $('#cart_2').find('a').attr('href', "javascript:void(0);");
            $('#cart_2').addClass('disable');
            $('#cart_2').removeClass('btn');
        } else {
            $('#cart_2').find('a').attr('href', "<{:U('market/order',array('t'=>$nowtime))}>");
            $('#cart_2').removeClass('disable');
            $('#cart_2').addClass('btn');
        }
    }




    function del(a) {
        var product_id = $(a).attr('did'), did = $(a).attr('did'),youhui = $(a).attr('cost');
        //先清空再复制
        $.each($('.change_price'),function(index,obj){
            if($(obj).attr('did')==product_id){
                $(obj).val('');
            }
        });
        window.market.removeby(product_id);
        $(".ordernum-"+did).val('0');
        $(".hide-"+did).addClass('hide');
        //已优惠价格
        $("#hui").text(window.market.summoney("<{$detail['shop_id']}>"));
        $("#num").text(window.market.count("<{$detail['shop_id']}>"));
        $("#total_price").html(window.market.totalprice("<{$detail['shop_id']}>"));
        var since_money = "<{$detail['since_money']}>";
        if (parseInt(window.market.totalprice("<{$detail['shop_id']}>")) < parseInt(since_money)) {
            $('#cart_2').find('a').attr('href', "javascript:void(0);");
            $('#cart_2').addClass('disable');
            $('#cart_2').removeClass('btn');
        } else {
            $('#cart_2').find('a').attr('href', "<{:U('market/order',array('t'=>$nowtime))}>");
            $('#cart_2').removeClass('disable');
            $('#cart_2').addClass('btn');
        }
    }

    //初始化购物城数据
    ~function () {
        var count = window.market.get_product_count();
        var totalprice = window.market.get_product_totalPrice();
        $("#num").text(count);
        $("#total_price").html(totalprice);
    }();


</script>
<script>
    product_arr=new Array();
    total_price_arr=new Array();
    $('.buy_btn').click(function(){
        $(this).prev().focus();
    });
    $(".change_price").bind("input propertychange",function(event){
        var data = {};
        var shop_id = "<{$detail['shop_id']}>";
        var product_id = $(this).attr('did');
        var price = $(this).attr('price');
        var youhui=$(this).attr('cost');
        var num = $(this).val();
        data['product_id'] = product_id;
        data['price'] =price;
        var count=get_product_count();
        var totalprice=get_product_totalPrice();
        var totalprices=get_youhui_totalPrice();
        if(num>0){
            $("#cart_2s").css({'background-color':'red','color':'#fff'}).removeClass("onclk");
        }else{
            $("#cart_2s").css({'background-color':'#dedede','color':'#fff'}).addClass("onclk");
        }
        window.market.addcart(shop_id,data,get_cart_info());
        $("#num").text(count);
        $("#hui").text(totalprices);
        $("#total_price").html(totalprice);
        var since_money = "<{$detail['since_money']}>";
        if (parseInt(window.market.totalprice("<{$detail['shop_id']}>")) < parseInt(since_money)) {
            $('#cart_2').find('a').attr('href', "javascript:void(0);");
            $('#cart_2').removeClass('btn');
            $('#cart_2').addClass('disable');
        } else {
            $('#cart_2').find('a').attr('href', "<{:U('market/order',array('t'=>$nowtime))}>");
            $('#cart_2').removeClass('disable');
            $('#cart_2').addClass('btn');
        }
    });
    //获取商品数量
    function  get_product_count(){
        var product_count=0;
        $.each($('.change_price'),function(index,obj){
            var num=$(obj).val();
            if(num>0){
                product_count++;
            }
        });
        return product_count;
    }
    //获取所有商品价格
    function  get_product_totalPrice(){
        var total_price=0;
        $.each($('.change_price'),function(index,obj){
            var price=$(obj).attr('price');
            var num=$(obj).val();
            total_price+=price*num;
        });
        return total_price.toFixed(2);
    }

    //获取所有商品价格的优惠价
    function  get_youhui_totalPrice(){
        var total_prices=0;
        $.each($('.change_price'),function(index,obj){
            var price=$(obj).attr('price');
            var cost=$(obj).attr('cost');
            var num=$(obj).val();
            total_prices+=(cost-price)*num;
        });
        return total_prices.toFixed(2);
    }
    //购物车商品信息
    function get_cart_info(){
        $.each($('.change_price'),function(index,obj){
            var price=$(obj).attr('price');
            var product_id=$(obj).attr('did');
            var youhui=$(obj).attr('cost');
            var num=$(obj).val()?$(obj).val():0;
            var product_info={'product_id':product_id, 'total_price':num*price,'num':num};
            total_price_arr[product_id]=product_info;
        });
        return total_price_arr;
    }

    // ~function () {
    //     var count = window.market.get_product_count();
    //     var totalprice = window.market.get_product_totalPrice();
    //     $("#num").text(count);
    //     $("#total_price").html(totalprice);
    // }();


    $(document).ready(function () {
        var obg = {
            name:"1234565",
            money:"10",
        }

        localStorage.setItem("name",JSON.stringify(obg));
    })
</script>
<div class="mask-filter-div" style="display: none;"></div>
<iframe id="x-frame" name="x-frame" style="display:none;"></iframe>
</body>
</html>
